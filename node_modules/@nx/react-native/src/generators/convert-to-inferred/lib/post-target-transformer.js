"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.postTargetTransformer = postTargetTransformer;
const plugin_migration_utils_1 = require("@nx/devkit/src/generators/plugin-migrations/plugin-migration-utils");
function postTargetTransformer(migrationLogs, processOptions) {
    return (target, _tree, projectDetails, inferredTargetConfiguration) => {
        if (target.options && processOptions) {
            processOptions(projectDetails.projectName, target.options, migrationLogs);
        }
        if (target.configurations && processOptions) {
            for (const configurationName in target.configurations) {
                const configuration = target.configurations[configurationName];
                processOptions(projectDetails.projectName, configuration, migrationLogs);
            }
            if (Object.keys(target.configurations).length === 0) {
                if ('defaultConfiguration' in target) {
                    delete target.defaultConfiguration;
                }
                delete target.configurations;
            }
            if ('defaultConfiguration' in target &&
                !target.configurations[target.defaultConfiguration]) {
                delete target.defaultConfiguration;
            }
        }
        if (target.outputs) {
            (0, plugin_migration_utils_1.processTargetOutputs)(target, [], inferredTargetConfiguration, {
                projectName: projectDetails.projectName,
                projectRoot: projectDetails.root,
            });
        }
        return target;
    };
}
